<!DOCTYPE html>
<html>
<head>
    <title>Stock Information</title>
    <style>

        .form-group {
            margin-bottom: 10px;
        }

        .form-group label {
            display: inline-block;
            width: 200px;
        }

        .form-group input {
            margin-left: 10px;
        }

        .form-group div {
            margin-left: 205px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        #sortContainer {
            text-align: center;
            margin-bottom: 20px;
        }

        #notes {
            text-align: center;
        }
        
        .delete-button {
            background-color: #ffffff;
            color: #f44336;
            border: 1px solid #f44336;
            padding: 6px 12px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .delete-button:hover {
            background-color: #f44336;
            color: #ffffff;
        }

    </style>
</head>
<body>
    <h1>Stock Information</h1>

    <form id="stockForm"> <!-- stock input form -->
        <div class="form-group">
            <label for="symbol">Stock Ticker:</label>
            <input type="text" id="ticker" maxlength="5" required><br>
        </div>
        <div class="form-group">
            <label for="price">Price per Share:</label>
            <input type="number" id="price" step="0.01" required><br>
        </div>
        <div class="form-group">
            <label for="apy">Yield Percentage (%):</label>
            <input type="number" id="yield" step="0.01" required><br>
        </div>
        <div class="form-group">
            <label for="payout-frequency">Payout Frequency:</label>

            <div>
                <input type="radio" id="weekly" name="payout" value="weekly" required>
                <label for="weekly">Weekly</label>
            </div>
            
            <div>
                <input type="radio" id="monthly" name="payout" value="monthly" required>
                <label for="monthly">Monthly</label>
            </div>

            <div>
                <input type="radio" id="quarterly" name="payout" value="quarterly" required>
                <label for="quarterly">Quarterly</label>
            </div>
        </div>        
        <div class="form-group">
            <label for="eps">EPS:</label>
            <input type="number" id="eps" step="0.01" required><br>
        </div>
        <div class="form-group">
            <label for="beta">Beta:</label>
            <input type="number" id="beta" step="0.01" optional><br>
        </div>

        <button type="submit">Submit</button>
    </form>

    <br>

    <div id="sortContainer"> <!-- options to sort table -->
        <label for="sortCriteria">Sort By:</label>
        <select id="sortCriteria">
            <option value="price">Price</option>
            <option value="yield">Yield Percentage</option>
            <option value="eps">EPS</option>
            <option value="beta">Beta</option>
            <option value="dividend_quotient">Dividend Quotient</option>
            <option value="pe_ratio">Price Earnings Ratio</option>
        </select>
    </div>

    <div id="results">
        <table id="stockTable">
            <thead>
                <tr>
                    <th></th> <!-- table headers for our stock table -->
                    <th>Stock Ticker</th>
                    <th>Price per Share</th>
                    <th>Yield Percentage</th>
                    <th>Payout Frequency</th>
                    <th>EPS</th>
                    <th>Beta</th>
                    <th>Annual Dividend Quotient</th>
                    <th>Price Earnings Ratio</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <br>
    <div id="notes">
        <p>Stocks with a beta less than 1 are generally considered less risky than stocks with a beta greater than 1.</p>
        <p>Stocks with a higher dividend quotient mean you are getting a higher annual dividend yield while spending less to purchase shares of the stock.</p>
        <p>A high P/E ratio could mean that a stock is overvalued, or that investors are expecting high growth rates in the future.</p>
    </div>

    <script>
        var stockDict = {};

        function displayStockInfo() {
            var tableBody = document.querySelector("#stockTable tbody");
            tableBody.innerHTML = ""; // removes all rows and content inside the table body

            var sortedStocks = Object.entries(stockDict).sort((a, b) => {
                var stockA = a[1];
                var stockB = b[1];

                if (sortCriteria === "price") {
                    return stockA.price - stockB.price; // lowest to highest sort
                } else if (sortCriteria === "yield") {
                    return stockB.yield - stockA.yield; // highest to lowest
                } else if (sortCriteria === "eps") {
                    return stockB.eps - stockA.eps; // highest to lowest
                } else if (sortCriteria === "beta") {
                    if (isNaN(stockA.beta)) return 1;
                    if (isNaN(stockB.beta)) return -1; // move to bottom if no beta
                    return stockA.beta - stockB.beta; // lowest to highest
                } else if (sortCriteria === "dividend_quotient") {
                    return stockB.dividend_quotient - stockA.dividend_quotient; // highest to lowest
                } else if (sortCriteria === "pe_ratio") {
                    return stockA.pe_ratio - stockB.pe_ratio; // lowest to highest
                }
            });

            sortedStocks.forEach(([stockTicker, stock]) => {
                var row = document.createElement("tr");
                row.innerHTML = `
                    <td>
                        <button class="delete-button" onclick="deleteStock('${stockTicker}')">Delete</button>
                    </td>
                    <td>${stockTicker.toUpperCase()}</td>
                    <td>${stock.price}</td>
                    <td>${stock.yield}</td>
                    <td>${stock.payout}</td>
                    <td>${stock.eps}</td>
                    <td>${stock.beta !== undefined && !isNaN(stock.beta) ? stock.beta : '-----'}</td>
                    <td>${stock.dividend_quotient.toFixed(3)}</td>
                    <td>${stock.pe_ratio.toFixed(3)}</td>
                `;

                tableBody.appendChild(row);
            });
        }

        function deleteStock(ticker) { // if a duplicate ticker is entered the row is deleted
            if (stockDict.hasOwnProperty(ticker)) {
                delete stockDict[ticker];
                displayStockInfo();
            }
        }

        document.getElementById("stockForm").addEventListener("submit", function(event) { // listens to the submit event of the form
            event.preventDefault();

            var tickerInput = document.getElementById("ticker");
            var priceInput = document.getElementById("price");
            var yieldInput = document.getElementById("yield");
            var epsInput = document.getElementById("eps");
            var betaInput = document.getElementById("beta");

            var ticker = tickerInput.value.toUpperCase();
            var price = parseFloat(priceInput.value);
            var yield = parseFloat(yieldInput.value);
            var eps = parseFloat(epsInput.value);
            var beta = parseFloat(betaInput.value);

            var weeklyCheckbox = document.getElementById("weekly");
            var monthlyCheckbox = document.getElementById("monthly");
            var quarterlyCheckbox = document.getElementById("quarterly");

            var payout = "";
            if (weeklyCheckbox.checked) {
                payout = "Weekly";
                var payoutValue = 52; // 52 weeks in a year
            } else if (monthlyCheckbox.checked) {
                payout = "Monthly";
                var payoutValue = 12; // 12 months in a year
            } else if (quarterlyCheckbox.checked) {
                payout = "Quarterly";
                var payoutValue = 4; // 4 quarters in a year
            }

            // Validate symbol input to ensure that no numbers are entered - only letters, forward slash, period, and colon
            var tickerRegex = /^[a-zA-Z/.:]+$/;
            if (!tickerRegex.test(ticker)) { // if a symbol such as a number is entered then the alert appears
                alert("Invalid ticker input. Please enter letters only.");
                return;
            }

            var dividendQuotient = (yield / price) * payoutValue;
            var peRatio = (eps <= 0) ? 0 : price / eps; // if eps <= 0 : then peRatio = 0 else peRatio = price/eps

            // clear leftover form input
            tickerInput.value = "";
            priceInput.value = "";
            yieldInput.value = "";
            epsInput.value = "";
            betaInput.value = "";
            weeklyCheckbox.checked = false;
            monthlyCheckbox.checked = false;
            quarterlyCheckbox.checked = false;

            if (stockDict.hasOwnProperty(ticker)) {
                alert("This stock has already been added.");
                return;
            }

            stockDict[ticker] = {
                price: price,
                yield: yield,
                payout: payout,
                eps: eps,
                beta: beta,
                dividend_quotient: dividendQuotient,
                pe_ratio: peRatio
            };

            displayStockInfo();
        });

        document.getElementById("sortCriteria").addEventListener("change", function(event) {
            sortCriteria = event.target.value;
            displayStockInfo();
        });
    </script>
</body>
</html>
